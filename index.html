<!DOCTYPE html> 
<html lang="tr"> 
    <head> 
        <meta charset="UTF-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>ÇINAR İTFAİYE</title>         
        <link rel="icon" type="image/png" href="logo.png"> 
        <link href="css/theme.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/> 
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>         
        <link rel="stylesheet" href="styles.css"> 
        <!-- Firebase SDK -->         
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>         
        <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>         
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Afacad&display=swap">
        <!-- jsQR barkod/QR kütüphanesi -->
        <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    </head>     
    <body> 
        <div id="map"></div>         
        <div class="search-container"> 
            <input type="text" id="search-input" placeholder="Ara"> 
            <button id="search-button" style="margin-left: 5px;">Ara</button>             
            <ul id="search-suggestions" class="suggestions-list" style="display: none;"></ul>             
        </div>         
        <div class="filter-container"> 
            <button id="filter-toggle" style="box-shadow: inset 0 0 10px -5px;">Sınıflar Filtrele</button>             
            <div id="filter-dropdown" class="filter-dropdown" style="display: none; margin-top: 50px;"> 
                <label>
                    <input type="checkbox" id="hide-all-filters"> Hepsini Gizle
                </label>                 
                <div id="filter-options"></div>                 
            </div>             
            <div class="inversion-container"> 
                <input type="checkbox" id="inversion-toggle" style="margin-top: 1px; margin-left: 4px; background-color: #778d06; border-right-width: 0px; margin-right: -7px;">
                <label for="inversion-toggle" style="margin-top: 3px; margin-left: 9px; background-color: #007bff; font-family: 'Afacad', sans-serif; font-weight: 400; letter-spacing: 0; text-indent: 6px; color: #ffffff; font-size: 20px; line-height: 28px; width: 143px; height: 28px; text-align: center; border-radius: 20px; border-width: 1px; box-shadow: inset 0 0 10px -6px;">Tersine Çevir</label>                 
            </div>             
        </div>         
        <!-- Hamburger menü butonu sadece mobilde görünür -->
        <button id="hamburger-menu" class="hamburger-menu" style="display: none; margin-top: 45px;"><span style="font-size:28px;">&#9776;</span>
        </button>
        <!-- Mobil panel: admin ile ilgili butonlar burada -->
        <div id="mobile-panel" class="mobile-panel" style="display:none;">
            <button id="admin-toggle-mobile">Admin Modu</button>
            <button id="close-admin-mobile" style="display:none;">Admin Modunu Kapat</button>
            <button id="show-admin-panel-mobile" style="display:none;">Marker Listesi</button>
            <button id="manage-classes-btn-mobile" style="display:none;">Sınıf Yönetimi</button>
            <button id="advanced-edit-btn-mobile" style="display:none;background:#218838;color:#ffffff;font-weight:600;">Gelişmiş Düzenleme</button>
            <button id="scan-barcode-btn-mobile" style="display:none;">Barkod Okut</button>
        </div>
        <!-- Masaüstü admin butonları -->
        <div class="admin-buttons">
            <button id="admin-toggle">Admin Modu</button>
            <button id="show-admin-panel" style="display: none;">Marker Listesi</button>
            <button id="manage-classes-btn" style="display: none;">Sınıf Yönetimi</button>
            <button id="advanced-edit-btn" style="display:none;background:#218838;color:#ffffff;font-weight:600;margin-left:10px;">Gelişmiş Düzenleme</button>
        </div>
        <!-- Gelişmiş Düzenleme Modalı (sadece bir tane bırakıldı) -->
        <div id="advanced-edit-modal" class="modal" style="display:none;z-index:99999;background:rgba(0,0,0,0.92);">
            <div class="modal-content" style="width:90vw;max-width:1200px;height:90vh;overflow:auto;position:relative;background:#fff;border-radius:18px;margin:3vh auto;padding:32px 24px;">
                <span class="close" id="advanced-edit-close" style="position:absolute;top:18px;right:32px;font-size:2.2em;cursor:pointer;">&times;</span>
                <h2 style="margin-bottom:18px;">Gelişmiş Düzenleme</h2>
                <div id="advanced-edit-step-select" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:60vh;">
                    <button id="advanced-edit-markers-btn" style="font-size:1.2em;padding:18px 44px;margin:18px 0 12px 0;">Markerları Düzenle</button>
                    <button id="advanced-edit-classes-btn" style="font-size:1.2em;padding:18px 44px;">Sınıfları Düzenle</button>
                </div>
                <div id="advanced-edit-markers-panel" style="display:none;"></div>
                <div id="advanced-edit-classes-panel" style="display:none;"></div>
            </div>
        </div>
        </div>
        <div id="login-modal" class="modal"> 
            <div class="modal-content" style="margin-top: 114px;"> <span class="close">&times;</span> 
                <h2>Admin Girişi</h2> 
                <form id="login-form"> 
                    <label>Kullanıcı Adı:</label>                     
                    <input type="text" id="username-input"> 
                    <label>Şifre:</label>                     
                    <input type="password" id="password-input"> 
                    <button type="submit" style="margin-top: 23px;">Giriş Yap</button>                     
                </form>                 
            </div>             
        </div>         
        <div id="admin-modal" class="modal"> 
            <div class="modal-content"> <span class="close">&times;</span> 
                <h2>Admin Paneli</h2> 
                <button id="add-new-marker">Yeni Marker Ekle</button>                 
                <h3>Marker Listesi</h3> 
                <ul id="marker-list"></ul>                 
            </div>             
        </div>         
        <div id="class-modal" class="modal"> 
            <div class="modal-content"> <span class="close">&times;</span> 
                <h2>Sınıf Yönetimi</h2> 
                <form id="class-form"> 
                    <label>Yeni Sınıf Adı:</label>                     
                    <input type="text" id="new-class-name"> 
                    <button type="submit">Sınıf Ekle</button>                     
                </form>                 
                <h3>Mevcut Sınıflar</h3> 
                <ul id="class-list"></ul>                 
            </div>             
        </div>         
        <div id="edit-modal" class="modal"> 
            <div class="modal-content"> <span class="close">&times;</span> 
                <h2>Marker Düzenle</h2> 
                <form id="marker-form"> 
                    <label>Başlık:</label>                     
                    <input type="text" id="title-input"> 
                    <label>Açıklama:</label>                     
                    <textarea id="desc-input"></textarea> 
                    <label>Sınıf:</label>                     
                    <select id="class-select"></select>                     
                    <label>Görsel URL (boş bırakılabilir):</label>                     
                    <input type="text" id="image-url-input"> 
                    <button type="button" id="add-image-url">URL Ekle</button>                     
                    <label>Yerel Görsel Yükle:</label>                     
                    <input type="file" id="image-file-input" accept="image/*" multiple> 
                    <div id="image-list"></div>                     
                    <label>Konum (otomatik seçilecek):</label>                     
                    <input type="text" id="latlng-input" readonly> 
                    <button type="submit">Kaydet</button>                     
                    <button type="button" id="delete-marker">Sil</button>                     
                    <button type="button" id="scan-barcode-btn" style="margin-left:8px;">Barkod Okut</button>
                    <!-- Barkod alanı (sadece admin modunda gösterilecek) -->
                    <div id="barcode-row" style="margin-top:12px;display:none;align-items:center;gap:8px;">
                        <label for="barcode-input" style="margin-bottom:0;">Barkod:</label>
                        <input type="text" id="barcode-input" style="width:180px;" readonly>
                        <button type="button" id="add-barcode-btn">Barkod Ekle</button>
                        <button type="button" id="remove-barcode-btn" style="display:none;">Barkodu Sil</button>
                    </div>
                </form>                 
                <p>Konum seçmek için haritaya tıklayın (admin modunda).</p> 
            </div>             
        </div>         
        <div id="image-viewer-modal" class="modal"> 
            <div class="image-viewer-content"> <span class="image-viewer-close">&times;</span> 
                <div id="image-viewer-map"></div>                 
                <button class="nav-button prev-button">&lt;</button>                 
                <button class="nav-button next-button">&gt;</button>                 
            </div>             
        </div>         
        <!-- Barkod Okuma Modalı (sadece admin modunda açılır) -->
        <div id="barcode-modal" class="modal" style="display:none;">
            <div class="modal-content" style="position:relative;max-width:420px;padding:0;overflow:hidden;">
                <span class="close" id="barcode-modal-close" style="position:absolute;top:8px;right:16px;z-index:2;font-size:2rem;cursor:pointer;">&times;</span>
                <div id="barcode-video-container" style="position:relative;width:100%;height:340px;background:#111;">
                    <video id="barcode-video" autoplay playsinline style="width:100%;height:100%;object-fit:cover;"></video>
                    <!-- Frame -->
                    <div id="barcode-frame" style="position:absolute;top:50%;left:50%;width:70%;height:40%;transform:translate(-50%,-50%);border:3px solid #00c853;border-radius:12px;z-index:1;"></div>
                    <!-- Şeffaf overlay -->
                    <div style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:0;clip-path:polygon(0 0,100% 0,100% 100%,0 100%,0 0,0 40%,15% 40%,15% 60%,0 60%,0 100%,100% 100%,100% 60%,85% 60%,85% 40%,100% 40%,100% 0);"></div>
                </div>
                <div id="barcode-status" style="text-align:center;padding:12px 0 8px 0;color:#007bff;font-weight:600;"></div>
            </div>
        </div>         
        <script src="script.js"></script>         
        <!-- Kullanıcı modunda barkod okutma butonu ve modalı (admin modundan bağımsız) -->
        <button id="user-barcode-btn" style="position:fixed;bottom:24px;right:24px;z-index:1000;padding:14px 22px 14px 18px;background:#fff;border-radius:32px;border:2px solid #007bff;box-shadow:0 2px 12px #0002;font-size:1.1em;display:none;align-items:center;gap:8px;cursor:pointer;">
            <span style="font-size:1.5em;">&#128439;</span> Barkod Tara
        </button>
        <div id="user-barcode-modal" class="modal" style="display:none;">
            <div class="modal-content" style="position:relative;max-width:420px;padding:0;overflow:hidden;">
                <span class="close" id="user-barcode-modal-close" style="position:absolute;top:8px;right:16px;z-index:2;font-size:2rem;cursor:pointer;">&times;</span>
                <div id="user-barcode-video-container" style="position:relative;width:100%;height:340px;background:#111;">
                    <video id="user-barcode-video" autoplay playsinline style="width:100%;height:100%;object-fit:cover;"></video>
                    <div id="user-barcode-frame" style="position:absolute;top:50%;left:50%;width:70%;height:40%;transform:translate(-50%,-50%);border:3px solid #00c853;border-radius:12px;z-index:1;"></div>
                    <div style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:0;clip-path:polygon(0 0,100% 0,100% 100%,0 100%,0 0,0 40%,15% 40%,15% 60%,0 60%,0 100%,100% 100%,100% 60%,85% 60%,85% 40%,100% 40%,100% 0);"></div>
                </div>
                <div id="user-barcode-status" style="text-align:center;padding:12px 0 8px 0;color:#007bff;font-weight:600;"></div>
            </div>
        </div>
    </body>     
</html>
